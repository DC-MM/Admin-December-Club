<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>December Club — Admin Dashboard</title>

<style>
  :root{
    --gold1:#f6e7b2; --gold2:#d9b86a; --gold3:#8b6a22;
    --wine:#5b0f22; --ink:#120b0d;
    --paper:#f5ead0; --paper2:#efe0bf;
    --shadow:0 26px 90px rgba(0,0,0,.22);
    --radius:14px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
    color:var(--ink);
    background:
      radial-gradient(900px 650px at 18% 10%, rgba(255,255,255,.35), transparent 60%),
      radial-gradient(900px 650px at 85% 12%, rgba(255,255,255,.22), transparent 62%),
      linear-gradient(145deg, var(--gold1), var(--gold2) 45%, var(--gold3));
    min-height:100vh;
    padding:24px;
  }
  .frame{
    width:min(1100px,100%);
    margin:0 auto;
    padding:18px;
    border-radius:18px;
    background:
      radial-gradient(900px 500px at 50% 0%, rgba(255,255,255,.25), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
    box-shadow:var(--shadow);
    position:relative;
  }
  .frame::before{
    content:"";
    position:absolute; inset:0;
    border-radius:18px;
    border:2px solid rgba(91,15,34,.75);
    pointer-events:none;
  }
  .frame::after{
    content:"";
    position:absolute; inset:12px;
    border-radius:14px;
    border:1px solid rgba(91,15,34,.45);
    pointer-events:none;
  }
  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:14px 14px 8px;
  }
  h1{ margin:0; font-size:34px; letter-spacing:.5px; }
  .sub{
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size:12px; color:rgba(18,11,13,.70); margin-top:2px;
  }
  .pillbar{
    display:flex; gap:10px; flex-wrap:wrap;
    padding:12px 14px 16px;
  }
  .pill{
    border:1px solid rgba(91,15,34,.25);
    background:rgba(255,255,255,.18);
    border-radius:999px;
    padding:9px 14px;
    cursor:pointer;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size:13px;
  }
  .pill.active{
    border-color:rgba(91,15,34,.55);
    background:rgba(245,234,208,.85);
  }
  .grid{
    display:grid;
    grid-template-columns: 1.2fr .8fr;
    gap:14px;
    padding:0 14px 14px;
  }
  @media (max-width:980px){ .grid{grid-template-columns:1fr;} }
  .card{
    border-radius:12px;
    border:1px solid rgba(91,15,34,.25);
    background:
      radial-gradient(900px 540px at 50% 0%, rgba(255,255,255,.34), transparent 62%),
      linear-gradient(180deg, rgba(245,234,208,.92), rgba(239,224,191,.86));
    padding:14px;
  }
  .row{
    display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    margin-bottom:12px;
  }
  .miniPill{
    border:1px solid rgba(91,15,34,.25);
    background:rgba(255,255,255,.18);
    border-radius:999px;
    padding:7px 12px;
    cursor:pointer;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size:12px;
  }
  .miniPill.active{
    border-color:rgba(91,15,34,.55);
    background:rgba(245,234,208,.85);
  }
  input,select,textarea{
    width:100%;
    padding:10px 10px;
    border-radius:10px;
    border:1px solid rgba(91,15,34,.35);
    background:rgba(255,255,255,.22);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size:13px;
    outline:none;
  }
  label{
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size:12px; color:rgba(18,11,13,.70);
    display:block; margin:10px 0 6px;
  }
  table{
    width:100%;
    border-collapse:separate;
    border-spacing:0 10px;
  }
  th{
    text-align:left;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size:12px;
    color:rgba(18,11,13,.70);
    padding:0 10px 6px;
  }
  td{
    background:rgba(255,255,255,.30);
    border:1px solid rgba(91,15,34,.18);
    padding:10px;
    vertical-align:middle;
  }
  td:first-child{border-radius:12px 0 0 12px}
  td:last-child{border-radius:0 12px 12px 0}
  .tag{
    display:inline-block;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(91,15,34,.22);
    background:rgba(255,255,255,.25);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size:12px;
  }
  .btn{
    padding:8px 10px;
    border-radius:10px;
    border:1px solid rgba(91,15,34,.35);
    background:rgba(245,234,208,.90);
    cursor:pointer;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size:12px;
    margin-right:6px;
  }
  .btn.danger{ border-color:rgba(160,20,55,.45); }
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .topRight{
    display:flex; gap:10px; align-items:center;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  }
  .logout{
    padding:8px 12px; border-radius:10px; border:1px solid rgba(91,15,34,.45);
    background:rgba(255,255,255,.18); cursor:pointer;
  }
  .msg{
    margin-top:10px;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size:12px;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid rgba(91,15,34,.22);
    background:rgba(255,255,255,.22);
    display:none;
  }
  .msg.error{
    border-color:rgba(160,20,55,.35);
    background:rgba(255,255,255,.18);
  }
  /* LOGIN modal */
  .loginWrap{
    max-width:420px;
    margin:70px auto 0;
  }
  .loginTitle{ font-size:30px; margin:0 0 6px; }
</style>
</head>

<body>
  <div class="frame">

    <!-- LOGIN -->
    <div id="loginView">
      <header style="padding-bottom:0">
        <div>
          <h1 class="loginTitle">Admin Dashboard</h1>
          <div class="sub">December Club — Administration Access</div>
        </div>
      </header>

      <div class="loginWrap card">
        <label>Username</label>
        <input id="adminUser" placeholder="December Family" />

        <label>Password</label>
        <input id="adminPass" type="password" placeholder="••••••••" />

        <button class="btn" id="loginBtn" style="width:100%;margin-top:12px">Login</button>
        <div class="msg" id="loginMsg"></div>
      </div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashView" style="display:none">

      <header>
        <div>
          <h1>Admin Dashboard</h1>
          <div class="sub">Manage members / invitations / meetings / donations / subscription.</div>
        </div>
        <div class="topRight">
          <button class="logout" id="logoutBtn">Logout</button>
        </div>
      </header>

      <div class="pillbar">
        <button class="pill active" data-tab="membersTab">Members</button>
        <button class="pill" data-tab="invitesTab">Invitations</button>
        <button class="pill" data-tab="meetingsTab">Meetings</button>
        <button class="pill" data-tab="donationsTab">Donations</button>
        <button class="pill" data-tab="subscriptionTab">Subscription</button>
      </div>

      <!-- MEMBERS TAB -->
      <div id="membersTab" class="tab">
        <div class="grid">
          <!-- LEFT: list -->
          <div class="card">
            <div class="row" style="justify-content:space-between">
              <div style="display:flex;gap:10px;flex-wrap:wrap">
                <button class="miniPill active" data-filter="all">All</button>
                <button class="miniPill" data-filter="member">Member</button>
                <button class="miniPill" data-filter="elite">Elite</button>
                <button class="miniPill" data-filter="private">Private</button>
              </div>

              <div style="min-width:260px;flex:1;max-width:420px">
                <input id="searchBox" placeholder="Search by number / name / email..." />
              </div>
            </div>

            <table>
              <thead>
                <tr>
                  <th style="width:130px">Number</th>
                  <th>Name</th>
                  <th style="width:130px">Category</th>
                  <th style="width:140px">Status</th>
                  <th style="width:260px">Actions</th>
                </tr>
              </thead>
              <tbody id="membersTbody"></tbody>
            </table>
          </div>

          <!-- RIGHT: form -->
          <div class="card">
            <h3 style="margin:0 0 4px">Add / Edit Member</h3>
            <div class="sub" style="margin-bottom:8px">Tip: member <b>0000</b> is protected from delete and critical edits.</div>

            <label>Member Number</label>
            <input id="f_number" placeholder="9 digits (except 0000)" />

            <label>Full Name</label>
            <input id="f_name" placeholder="Full name" />

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
              <div>
                <label>Email</label>
                <input id="f_email" placeholder="name@example.com" />
              </div>
              <div>
                <label>Country</label>
                <input id="f_country" placeholder="UAE" />
              </div>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
              <div>
                <label>Category</label>
                <select id="f_category">
                  <option value="member">member</option>
                  <option value="elite">elite</option>
                  <option value="private">private</option>
                </select>
              </div>
              <div>
                <label>Status</label>
                <select id="f_status">
                  <option value="Activated">Activated</option>
                  <option value="Inactivated">Inactivated</option>
                  <option value="Banned">Banned</option>
                </select>
              </div>
            </div>

            <label>Passport PDF (admin upload)</label>
            <input id="f_passport_pdf" type="file" accept="application/pdf" />

            <label>Signed Terms PDF (admin upload)</label>
            <input id="f_terms_pdf" type="file" accept="application/pdf" />

            <label>Notes</label>
            <textarea id="f_notes" rows="3" placeholder="Notes..."></textarea>

            <div style="display:flex;gap:8px;margin-top:10px">
              <button class="btn" id="saveBtn">Save</button>
              <button class="btn danger" id="deleteBtn">Delete</button>
              <button class="btn" id="resetBtn" type="button">Reset</button>
            </div>

            <div class="msg" id="formMsg"></div>
          </div>
        </div>
      </div>

      <!-- INVITES -->
      <div id="invitesTab" class="tab" style="display:none">
        <div class="card">
          <h3 style="margin:0 0 8px">Invitations</h3>
          <div class="sub">Placeholder section (we’ll implement later).</div>
        </div>
      </div>

      <!-- MEETINGS -->
      <div id="meetingsTab" class="tab" style="display:none">
        <div class="card">
          <h3 style="margin:0 0 8px">Meetings</h3>
          <div class="sub">Placeholder section (we’ll implement later).</div>
        </div>
      </div>

      <!-- DONATIONS -->
      <div id="donationsTab" class="tab" style="display:none">
        <div class="card">
          <h3 style="margin:0 0 8px">Donations</h3>
          <div class="sub">Placeholder section (we’ll implement later).</div>
        </div>
      </div>

      <!-- SUBSCRIPTION -->
      <div id="subscriptionTab" class="tab" style="display:none">
        <div class="card">
          <h3 style="margin:0 0 8px">Subscription</h3>
          <div class="sub" style="margin-bottom:10px">Annual membership fee:</div>
          <div style="font-size:18px"><b>$15,000</b> / year</div>
        </div>
      </div>

    </div>
  </div>

<script>
/* =======================
   SETTINGS
======================= */
const ADMIN_USER = "December Family";
const ADMIN_PASS = "De@Ce@Mb@Er";

/* =======================
   HELPERS
======================= */
const $ = (id) => document.getElementById(id);

function showMsg(el, text, isError=false){
  el.textContent = text;
  el.classList.toggle("error", !!isError);
  el.style.display = "block";
}
function hideMsg(el){
  el.textContent = "";
  el.classList.remove("error");
  el.style.display = "none";
}
function clean(v){ return String(v||"").trim(); }

function isValidMemberNumber(num){
  // allow ONLY 0000 for owner
  if(num === "0000") return true;
  // everyone else must be exactly 9 digits
  return /^\d{9}$/.test(num);
}

function loadMembers(){
  const raw = localStorage.getItem("dc_admin_members_v1");
  if(raw){
    try { return JSON.parse(raw); } catch(e){}
  }
  // default owner
  return [{
    number:"0000",
    name:"M. Mavros",
    email:"",
    country:"",
    category:"private",
    status:"Activated",
    notes:"Owner (protected)",
    passport_pdf:null,  // {name, dataUrl}
    terms_pdf:null      // {name, dataUrl}
  }];
}
function saveMembers(){
  localStorage.setItem("dc_admin_members_v1", JSON.stringify(MEMBERS));
}

function findMember(num){
  return MEMBERS.find(m => m.number === num);
}

async function fileToDataUrl(file){
  if(!file) return null;
  return new Promise((resolve, reject) => {
    const r = new FileReader();
    r.onload = () => resolve(String(r.result));
    r.onerror = reject;
    r.readAsDataURL(file);
  });
}

function openPdfFromDataUrl(dataUrl){
  // open in new tab
  const w = window.open();
  if(!w){ alert("Pop-up blocked. Allow pop-ups then try again."); return; }
  w.document.write(
    `<iframe src="${dataUrl}" style="border:0;width:100%;height:100vh"></iframe>`
  );
}

/* =======================
   STATE
======================= */
let MEMBERS = loadMembers();
let activeFilter = "all";
let editingNumber = null;

/* =======================
   LOGIN
======================= */
$("loginBtn").addEventListener("click", () => {
  hideMsg($("loginMsg"));
  const u = clean($("adminUser").value);
  const p = $("adminPass").value || "";
  if(u === ADMIN_USER && p === ADMIN_PASS){
    $("loginView").style.display = "none";
    $("dashView").style.display = "block";
    renderMembers();
    resetForm();
  } else {
    showMsg($("loginMsg"), "Wrong credentials.", true);
  }
});

$("logoutBtn").addEventListener("click", () => {
  location.reload();
});

/* =======================
   TABS
======================= */
document.querySelectorAll(".pill").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".pill").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");

    const tab = btn.dataset.tab;
    document.querySelectorAll(".tab").forEach(t=>t.style.display="none");
    document.getElementById(tab).style.display = "block";
  });
});

/* =======================
   FILTERS
======================= */
document.querySelectorAll(".miniPill").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".miniPill").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    activeFilter = btn.dataset.filter;
    renderMembers();
  });
});

$("searchBox").addEventListener("input", renderMembers);

/* =======================
   FORM ACTIONS
======================= */
$("resetBtn").addEventListener("click", resetForm);

$("saveBtn").addEventListener("click", async () => {
  hideMsg($("formMsg"));

  const number = clean($("f_number").value);
  const name = clean($("f_name").value);
  const email = clean($("f_email").value);
  const country = clean($("f_country").value);
  const category = $("f_category").value;
  const status = $("f_status").value;
  const notes = clean($("f_notes").value);

  if(!number){
    showMsg($("formMsg"), "Member number is required.", true); return;
  }
  if(!isValidMemberNumber(number)){
    showMsg($("formMsg"), "Error: Member number must be 9 digits (except 0000).", true);
    return;
  }
  if(!name){
    showMsg($("formMsg"), "Full name is required.", true); return;
  }

  // owner name always fixed
  if(number === "0000" && name !== "M. Mavros"){
    showMsg($("formMsg"), "Owner name must be: M. Mavros", true);
    $("f_name").value = "M. Mavros";
    return;
  }

  // read pdf uploads (optional)
  const passportFile = $("f_passport_pdf").files[0] || null;
  const termsFile = $("f_terms_pdf").files[0] || null;

  let passport_pdf = null;
  let terms_pdf = null;

  if(passportFile){
    if(passportFile.type !== "application/pdf"){
      showMsg($("formMsg"), "Passport must be a PDF file.", true); return;
    }
    passport_pdf = {
      name: passportFile.name,
      dataUrl: await fileToDataUrl(passportFile)
    };
  }

  if(termsFile){
    if(termsFile.type !== "application/pdf"){
      showMsg($("formMsg"), "Signed terms must be a PDF file.", true); return;
    }
    terms_pdf = {
      name: termsFile.name,
      dataUrl: await fileToDataUrl(termsFile)
    };
  }

  // protect owner from critical edits (keep name fixed)
  if(editingNumber === "0000" && number !== "0000"){
    showMsg($("formMsg"), "Owner record cannot change number.", true); return;
  }

  // update existing or insert new
  const existing = findMember(editingNumber || number);

  if(existing){
    // if editing existing but changing number, ensure not duplicate
    if(existing.number !== number && findMember(number)){
      showMsg($("formMsg"), "This member number already exists.", true);
      return;
    }

    // owner: allow only safe fields
    if(existing.number === "0000"){
      existing.name = "M. Mavros";
      existing.email = email;
      existing.country = country;
      existing.category = "private";
      existing.status = status;
      existing.notes = notes || "Owner (protected)";
      if(passport_pdf) existing.passport_pdf = passport_pdf;
      if(terms_pdf) existing.terms_pdf = terms_pdf;
    } else {
      existing.number = number;
      existing.name = name;
      existing.email = email;
      existing.country = country;
      existing.category = category;
      existing.status = status;
      existing.notes = notes;

      // keep old pdfs unless replaced
      if(passport_pdf) existing.passport_pdf = passport_pdf;
      if(terms_pdf) existing.terms_pdf = terms_pdf;
    }
  } else {
    // new insert
    if(findMember(number)){
      showMsg($("formMsg"), "This member number already exists.", true);
      return;
    }

    MEMBERS.push({
      number,
      name,
      email,
      country,
      category,
      status,
      notes,
      passport_pdf: passport_pdf || null,
      terms_pdf: terms_pdf || null
    });
  }

  saveMembers();
  renderMembers();
  resetForm();
  showMsg($("formMsg"), "Saved.", false);
});

$("deleteBtn").addEventListener("click", () => {
  hideMsg($("formMsg"));
  const num = clean($("f_number").value);

  if(!num){
    showMsg($("formMsg"), "Enter a member number to delete.", true); return;
  }
  if(num === "0000"){
    showMsg($("formMsg"), "Owner is protected and cannot be deleted.", true); return;
  }

  const idx = MEMBERS.findIndex(m => m.number === num);
  if(idx === -1){
    showMsg($("formMsg"), "Member not found.", true); return;
  }

  MEMBERS.splice(idx, 1);
  saveMembers();
  renderMembers();
  resetForm();
  showMsg($("formMsg"), "Deleted.", false);
});

function resetForm(){
  editingNumber = null;
  $("f_number").value = "";
  $("f_name").value = "";
  $("f_email").value = "";
  $("f_country").value = "";
  $("f_category").value = "member";
  $("f_status").value = "Activated";
  $("f_notes").value = "";
  $("f_passport_pdf").value = "";
  $("f_terms_pdf").value = "";
  hideMsg($("formMsg"));
}

/* =======================
   RENDER MEMBERS TABLE
======================= */
function renderMembers(){
  const q = clean($("searchBox").value).toLowerCase();

  const filtered = MEMBERS.filter(m => {
    const matchesFilter = (activeFilter === "all") ? true : (m.category === activeFilter);
    const matchesSearch = !q
      ? true
      : (
          (m.number || "").toLowerCase().includes(q) ||
          (m.name || "").toLowerCase().includes(q) ||
          (m.email || "").toLowerCase().includes(q)
        );
    return matchesFilter && matchesSearch;
  });

  const tbody = $("membersTbody");
  tbody.innerHTML = "";

  filtered.forEach(m => {
    const ownerProtected = (m.number === "0000");

    const passportBtn = m.passport_pdf?.dataUrl
      ? `<button class="btn" data-act="view-passport" data-num="${m.number}">Passport</button>`
      : `<button class="btn" disabled>Passport</button>`;

    const termsBtn = m.terms_pdf?.dataUrl
      ? `<button class="btn" data-act="view-terms" data-num="${m.number}">Terms</button>`
      : `<button class="btn" disabled>Terms</button>`;

    tbody.insertAdjacentHTML("beforeend", `
      <tr>
        <td><span class="tag">${m.number}</span></td>
        <td><b>${escapeHtml(m.name || "")}</b></td>
        <td><span class="tag">${m.category}</span></td>
        <td><span class="tag">${m.status}</span></td>
        <td>
          <button class="btn" data-act="edit" data-num="${m.number}">Edit</button>
          ${ownerProtected ? `<button class="btn danger" disabled>Delete</button>` : `<button class="btn danger" data-act="quick-delete" data-num="${m.number}">Delete</button>`}
          ${passportBtn}
          ${termsBtn}
          ${ownerProtected ? `<span class="sub" style="margin-left:6px">Owner protected</span>` : ``}
        </td>
      </tr>
    `);
  });

  // bind actions
  tbody.querySelectorAll("button[data-act]").forEach(btn => {
    btn.addEventListener("click", () => {
      const act = btn.dataset.act;
      const num = btn.dataset.num;

      if(act === "edit"){
        const m = findMember(num);
        if(!m) return;

        editingNumber = m.number;
        $("f_number").value = m.number;
        $("f_name").value = (m.number === "0000") ? "M. Mavros" : (m.name || "");
        $("f_email").value = m.email || "";
        $("f_country").value = m.country || "";
        $("f_category").value = m.category || "member";
        $("f_status").value = m.status || "Activated";
        $("f_notes").value = m.notes || "";
        $("f_passport_pdf").value = "";
        $("f_terms_pdf").value = "";

        hideMsg($("formMsg"));
        showMsg($("formMsg"),
          (m.number === "0000")
            ? "Editing owner: name fixed (M. Mavros). You can update PDFs + status + notes."
            : "Editing member.",
          false
        );
        return;
      }

      if(act === "quick-delete"){
        if(num === "0000") return;
        const idx = MEMBERS.findIndex(x => x.number === num);
        if(idx !== -1){
          MEMBERS.splice(idx, 1);
          saveMembers();
          renderMembers();
          resetForm();
        }
        return;
      }

      if(act === "view-passport"){
        const m = findMember(num);
        if(m?.passport_pdf?.dataUrl) openPdfFromDataUrl(m.passport_pdf.dataUrl);
        return;
      }

      if(act === "view-terms"){
        const m = findMember(num);
        if(m?.terms_pdf?.dataUrl) openPdfFromDataUrl(m.terms_pdf.dataUrl);
        return;
      }
    });
  });
}

function escapeHtml(s){
  return String(s || "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
</script>

</body>
</html>
